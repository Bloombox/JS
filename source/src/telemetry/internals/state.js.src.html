<!DOCTYPE html><html lang="en" class="loading"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"><title>state.js</title><link href="../../../../dossier.css" rel="stylesheet" type="text/css"><script src="../../../../types.js" defer></script><header><button class="dossier-menu"><i class="material-icons">menu</i></button><form><input type="search" placeholder="Search" tabindex="1"><i class="material-icons">search</i></form></header><nav class="dossier-nav"></nav><div class="content"><main data-page-data="[null,null,null,[&quot;state.js&quot;,&quot;src/telemetry/internals/state.js&quot;,[null,&quot;/*&quot;,&quot; * Copyright 2018, Bloombox, LLC. All rights reserved.&quot;,&quot; *&quot;,&quot; * Source and object computer code contained herein is the private intellectual&quot;,&quot; * property of Bloombox, a California Limited Liability Corporation. Use of this&quot;,&quot; * code in source form requires permission in writing before use or the&quot;,&quot; * assembly, distribution, or publishing of derivative works, for commercial&quot;,&quot; * purposes or any other purpose, from a duly authorized officer of Momentum&quot;,&quot; * Ideas Co.&quot;,&quot; *&quot;,&quot; * Unless required by applicable law or agreed to in writing, software&quot;,&quot; * distributed under the License is distributed on an \&quot;AS IS\&quot; BASIS,&quot;,&quot; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&quot;,&quot; * See the License for the specific language governing permissions and&quot;,&quot; * limitations under the License.&quot;,&quot; */&quot;,null,&quot;/**&quot;,&quot; * Bloombox Telemetry: State Manager&quot;,&quot; *&quot;,&quot; * @fileoverview Provides centralized RPC state management.&quot;,&quot; */&quot;,null,&quot;/*global goog */&quot;,null,&quot;goog.provide(&#39;bloombox.telemetry.internals.LocalStats&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.activate&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.active&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.deactivate&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.disable&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.enable&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.enabled&#39;);&quot;,null,&quot;goog.provide(&#39;bloombox.telemetry.internals.state.ACTIVE_&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.state.ENABLED_&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.state.EVENT_ERROR_COUNT_&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.state.EVENT_SUCCESS_COUNT_&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.state.LAST_PING_SENT_&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.state.LAST_PONG_RECEIVED_&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.state.QUEUED_EVENT_COUNT_&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.state.SENT_EVENT_COUNT_&#39;);&quot;,null,&quot;goog.provide(&#39;bloombox.telemetry.internals.statistics&#39;);&quot;,null,&quot;goog.provide(&#39;bloombox.telemetry.internals.stats.recordPing&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.stats.recordPong&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.stats.recordRPCError&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.stats.recordRPCSent&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.stats.recordRPCSuccess&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.internals.stats.updateRPCQueued&#39;);&quot;,null,null,&quot;/**&quot;,&quot; * Type declaration for a record that provides statistics about the local&quot;,&quot; * telemetry subsystem.&quot;,&quot; *&quot;,&quot; * @typedef {{&quot;,&quot; *   queued: number,&quot;,&quot; *   sent: number,&quot;,&quot; *   errors: number,&quot;,&quot; *   success: number,&quot;,&quot; *   lastPing: number,&quot;,&quot; *   lastPong: number&quot;,&quot; * }}&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.LocalStats;&quot;,null,null,&quot;// - Enabled State - //&quot;,&quot;/**&quot;,&quot; * Query whether the telemetry system is enabled.&quot;,&quot; *&quot;,&quot; * @return {boolean}&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.enabled = function() {&quot;,&quot;  return bloombox.telemetry.internals.state.ENABLED_;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Disable the telemetry system.&quot;,&quot; *&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.disable = function() {&quot;,&quot;  bloombox.telemetry.internals.state.ENABLED_ = false;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Enable the telemetry system.&quot;,&quot; *&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.enable = function() {&quot;,&quot;  bloombox.telemetry.internals.state.ENABLED_ = true;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Record that a ping was sent.&quot;,&quot; *&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.stats.recordPing = function() {&quot;,&quot;  bloombox.telemetry.internals.state.LAST_PING_SENT_ = +(new Date());&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Record that a pong was received.&quot;,&quot; *&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.stats.recordPong = function() {&quot;,&quot;  bloombox.telemetry.internals.state.LAST_PONG_RECEIVED_ = +(new Date());&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Record that an RPC error happened.&quot;,&quot; *&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.stats.recordRPCError = function() {&quot;,&quot;  bloombox.telemetry.internals.state.EVENT_ERROR_COUNT_++;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Record that an RPC success happened.&quot;,&quot; *&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.stats.recordRPCSuccess = function() {&quot;,&quot;  bloombox.telemetry.internals.state.EVENT_SUCCESS_COUNT_++;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Record that an RPC was sent.&quot;,&quot; *&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.stats.recordRPCSent = function() {&quot;,&quot;  bloombox.telemetry.internals.state.SENT_EVENT_COUNT_++;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Update queued RPC count.&quot;,&quot; *&quot;,&quot; * @param {number} queued_count Current count of queued RPCs.&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.stats.updateRPCQueued = function(queued_count) {&quot;,&quot;  bloombox.telemetry.internals.state.QUEUED_EVENT_COUNT_ = queued_count;&quot;,&quot;};&quot;,null,null,&quot;// - Active State - //&quot;,&quot;/**&quot;,&quot; * Query whether the telemetry system is currently active or paused.&quot;,&quot; *&quot;,&quot; * @return {boolean}&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.active = function() {&quot;,&quot;  return (&quot;,&quot;    bloombox.telemetry.internals.state.ENABLED_ &amp;&amp;&quot;,&quot;    bloombox.telemetry.internals.state.ACTIVE_);&quot;,&quot;};&quot;,null,&quot;/**&quot;,&quot; * Activate the telemetry system.&quot;,&quot; *&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.activate = function() {&quot;,&quot;  bloombox.telemetry.internals.state.ACTIVE_ = true;&quot;,null,&quot;  // perform a tick to re-start the queue&quot;,&quot;  bloombox.telemetry.internals.tick();&quot;,&quot;};&quot;,null,&quot;/**&quot;,&quot; * Deactivate the telemetry system.&quot;,&quot; *&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.deactivate = function() {&quot;,&quot;  bloombox.telemetry.internals.state.ACTIVE_ = false;&quot;,&quot;};&quot;,null,null,&quot;// - Statistics - //&quot;,&quot;/**&quot;,&quot; * Return stats about the local telemetry subsystem.&quot;,&quot; *&quot;,&quot; * @return {bloombox.telemetry.internals.LocalStats}&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.statistics = function() {&quot;,&quot;  let stats = (/** @type {bloombox.telemetry.internals.LocalStats} */ ({&quot;,&quot;    queued: bloombox.telemetry.internals.state.QUEUED_EVENT_COUNT_,&quot;,&quot;    sent: bloombox.telemetry.internals.state.SENT_EVENT_COUNT_,&quot;,&quot;    errors: bloombox.telemetry.internals.state.EVENT_ERROR_COUNT_,&quot;,&quot;    success: bloombox.telemetry.internals.state.EVENT_SUCCESS_COUNT_,&quot;,&quot;    lastPing: bloombox.telemetry.internals.state.LAST_PING_SENT_,&quot;,&quot;    lastPong: bloombox.telemetry.internals.state.LAST_PONG_RECEIVED_&quot;,&quot;  }));&quot;,null,&quot;  if (Object.isFrozen &amp;&amp; !Object.isFrozen(stats)) {&quot;,&quot;    Object.freeze(stats);&quot;,&quot;  }&quot;,&quot;  return stats;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Whether telemetry services are enabled at all.&quot;,&quot; *&quot;,&quot; * @type {boolean}&quot;,&quot; * @private&quot;,&quot; * @nocollapse&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.state.ENABLED_ = true;&quot;,null,null,&quot;/**&quot;,&quot; * Whether telemetry services are active - i.e. currently sending events. This&quot;,&quot; * requires an active internet connection and the page must be in one of a&quot;,&quot; * certain set of visibility states.&quot;,&quot; *&quot;,&quot; * @type {boolean}&quot;,&quot; * @private&quot;,&quot; * @nocollapse&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.state.ACTIVE_ = true;&quot;,null,null,&quot;/**&quot;,&quot; * Last time we sent a `PING` call to the Telemetry service. Null means we have&quot;,&quot; * not yet sent one.&quot;,&quot; *&quot;,&quot; * @type {?number}&quot;,&quot; * @private&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.state.LAST_PING_SENT_ = null;&quot;,null,null,&quot;/**&quot;,&quot; * Last time we received a `PONG` to our `PING`. Null means we have not yet&quot;,&quot; * received one.&quot;,&quot; *&quot;,&quot; * @type {?number}&quot;,&quot; * @private&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.state.LAST_PONG_RECEIVED_ = null;&quot;,null,null,&quot;/**&quot;,&quot; * Global count of queued events.&quot;,&quot; *&quot;,&quot; * @type {number}&quot;,&quot; * @private&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.state.QUEUED_EVENT_COUNT_ = 0;&quot;,null,null,&quot;/**&quot;,&quot; * Global count of events sent to the Telemetry Service.&quot;,&quot; *&quot;,&quot; * @type {number}&quot;,&quot; * @private&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.state.SENT_EVENT_COUNT_ = 0;&quot;,null,null,&quot;/**&quot;,&quot; * Global count of errors received back for events sent to the Telemetry&quot;,&quot; * Service. Should always be less than or equal to SENT_EVENT_COUNT.&quot;,&quot; *&quot;,&quot; * @type {number}&quot;,&quot; * @private&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.state.EVENT_ERROR_COUNT_ = 0;&quot;,null,null,&quot;/**&quot;,&quot; * Global count of successful events submitted to the Telemetry Service. Should&quot;,&quot; * always be less than or equal to SENT_EVENT_COUNT.&quot;,&quot; *&quot;,&quot; * @type {number}&quot;,&quot; * @private&quot;,&quot; */&quot;,&quot;bloombox.telemetry.internals.state.EVENT_SUCCESS_COUNT_ = 0;&quot;]]]"></main><footer><div><a href="https://github.com/jleyba/js-dossier">Generated by dossier</a></div></footer></div><script src="../../../../dossier.js" defer></script>