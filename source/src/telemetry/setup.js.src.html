<!DOCTYPE html><html lang="en" class="loading"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"><title>setup.js</title><link href="../../../dossier.css" rel="stylesheet" type="text/css"><script src="../../../types.js" defer></script><header><button class="dossier-menu"><i class="material-icons">menu</i></button><form><input type="search" placeholder="Search" tabindex="1"><i class="material-icons">search</i></form></header><nav class="dossier-nav"></nav><div class="content"><main data-page-data="[null,null,null,[&quot;setup.js&quot;,&quot;src/telemetry/setup.js&quot;,[null,&quot;/*&quot;,&quot; * Copyright 2018, Bloombox, LLC. All rights reserved.&quot;,&quot; *&quot;,&quot; * Source and object computer code contained herein is the private intellectual&quot;,&quot; * property of Bloombox, a California Limited Liability Corporation. Use of this&quot;,&quot; * code in source form requires permission in writing before use or the&quot;,&quot; * assembly, distribution, or publishing of derivative works, for commercial&quot;,&quot; * purposes or any other purpose, from a duly authorized officer of Momentum&quot;,&quot; * Ideas Co.&quot;,&quot; *&quot;,&quot; * Unless required by applicable law or agreed to in writing, software&quot;,&quot; * distributed under the License is distributed on an \&quot;AS IS\&quot; BASIS,&quot;,&quot; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&quot;,&quot; * See the License for the specific language governing permissions and&quot;,&quot; * limitations under the License.&quot;,&quot; */&quot;,null,&quot;/**&quot;,&quot; * Bloombox Telemetry: Setup&quot;,&quot; *&quot;,&quot; * @fileoverview Provides routines called during page setup for use of the&quot;,&quot; * Bloombox Telemetry API.&quot;,&quot; */&quot;,null,&quot;/*global goog */&quot;,null,&quot;goog.require(&#39;bloombox.config.active&#39;);&quot;,null,&quot;goog.require(&#39;bloombox.logging.error&#39;);&quot;,&quot;goog.require(&#39;bloombox.logging.log&#39;);&quot;,&quot;goog.require(&#39;bloombox.logging.warn&#39;);&quot;,null,&quot;goog.require(&#39;bloombox.telemetry.DEBUG&#39;);&quot;,&quot;goog.require(&#39;bloombox.telemetry.InternalCollection&#39;);&quot;,&quot;goog.require(&#39;bloombox.telemetry.TELEMETRY_API_ENDPOINT&#39;);&quot;,&quot;goog.require(&#39;bloombox.telemetry.VERSION&#39;);&quot;,null,&quot;goog.provide(&#39;bloombox.telemetry.boot&#39;);&quot;,&quot;goog.require(&#39;bloombox.telemetry.didOptOut&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.sendInitialEvents&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.setup&#39;);&quot;,&quot;goog.provide(&#39;bloombox.telemetry.setupPageTracking&#39;);&quot;,null,&quot;goog.require(&#39;bloombox.telemetry.ping&#39;);&quot;,null,null,&quot;/**&quot;,&quot; * Setup the Bloombox Telemetry API. Provide your API key and an endpoint if you&quot;,&quot; * would like to override the default (most users should not need to).&quot;,&quot; *&quot;,&quot; * @param {string} partner Partner code to use.&quot;,&quot; * @param {string} location Location code to use.&quot;,&quot; * @param {string} apikey API key to use.&quot;,&quot; * @param {function()} callback Callback dispatched when the Shop API is ready.&quot;,&quot; * @param {string=} endpoint Override for endpoint. Uses default if unspecified.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.telemetry.setup = function(partner,&quot;,&quot;                                    location,&quot;,&quot;                                    apikey,&quot;,&quot;                                    callback,&quot;,&quot;                                    endpoint) {&quot;,&quot;  if (!partner || !location) {&quot;,&quot;    bloombox.logging.error(&#39;Partner or location code is not defined.&#39;);&quot;,&quot;    return;&quot;,&quot;  }&quot;,null,&quot;  let config = bloombox.config.active();&quot;,&quot;  let merged = /** @type {bloombox.config.JSConfig} */ (&quot;,&quot;    Object.assign({}, config, {&#39;endpoints&#39;:&quot;,&quot;      Object.assign({}, config.endpoints || {}, {&quot;,&quot;        shop: endpoint || bloombox.telemetry.TELEMETRY_API_ENDPOINT})}));&quot;,null,&quot;  bloombox.config.configure(merged);&quot;,null,&quot;  bloombox.logging.log(&#39;Telemetry is ready for use.&#39;,&quot;,&quot;    {&#39;version&#39;: bloombox.telemetry.VERSION,&quot;,&quot;      &#39;debug&#39;: bloombox.telemetry.DEBUG,&quot;,&quot;      &#39;config&#39;: bloombox.config.active()});&quot;,&quot;  callback();&quot;,&quot;  bloombox.telemetry.boot();&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Begin handling telemetry data, starting with initial events to be dispatched&quot;,&quot; * and an initial server ping.&quot;,&quot; *&quot;,&quot; * @package&quot;,&quot; */&quot;,&quot;bloombox.telemetry.sendInitialEvents = function() {&quot;,&quot;  if (bloombox.telemetry.didOptOut()) {&quot;,&quot;    // user opted out of telemetry&quot;,&quot;    bloombox.logging.warn(&quot;,&quot;      &#39;User opted-out of telemetry, skipping initial events.&#39;);&quot;,&quot;  } else {&quot;,&quot;    // user has not yet opted out&quot;,&quot;    bloombox.telemetry.event(&quot;,&quot;      bloombox.telemetry.InternalCollection.LIBRARY,&quot;,&quot;      {&#39;distribution&#39;: &#39;js-client&#39;}).send();&quot;,&quot;  }&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Last observed window location.&quot;,&quot; *&quot;,&quot; * @type {string}&quot;,&quot; * @private&quot;,&quot; */&quot;,&quot;bloombox.telemetry.lastURL_ = window.location.href;&quot;,null,null,&quot;/**&quot;,&quot; * Milliseconds to wait between URL checks.&quot;,&quot; *&quot;,&quot; * @const {number}&quot;,&quot; * @private&quot;,&quot; */&quot;,&quot;bloombox.telemetry.URL_CHECK_TICK_MS_ = 1500;&quot;,null,null,&quot;/**&quot;,&quot; * Send a telemetry event due to a URL/location change.&quot;,&quot; *&quot;,&quot; * @private&quot;,&quot; */&quot;,&quot;bloombox.telemetry.urlDidChange_ = function() {&quot;,&quot;  // one last check...&quot;,&quot;  if (window.location.href !== bloombox.telemetry.lastURL_) {&quot;,&quot;    bloombox.telemetry.lastURL_ = window.location.href;&quot;,&quot;    bloombox.logging.log(&#39;URL changed, sending pageview.&#39;,&quot;,&quot;      {&#39;location&#39;: bloombox.telemetry.lastURL_});&quot;,null,&quot;    bloombox.telemetry.event(&quot;,&quot;      bloombox.telemetry.InternalCollection.PAGEVIEW).send();&quot;,&quot;  }&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Check the current window location against the last observed one.&quot;,&quot; *&quot;,&quot; * @private&quot;,&quot; */&quot;,&quot;bloombox.telemetry.checkURL_ = function() {&quot;,&quot;  if (window.location.href !== bloombox.telemetry.lastURL_) {&quot;,&quot;    // update it&quot;,&quot;    bloombox.telemetry.urlDidChange_();&quot;,&quot;  }&quot;,null,&quot;  // repeat the check in URL_CHECK_TICK_MS milliseconds&quot;,&quot;  setTimeout(bloombox.telemetry.checkURL_,&quot;,&quot;    bloombox.telemetry.URL_CHECK_TICK_MS_);&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Setup a page tracking listener, and also dispatch it once every N seconds to&quot;,&quot; * catch URL changes.&quot;,&quot; */&quot;,&quot;bloombox.telemetry.setupPageTracking = function() {&quot;,&quot;  window.addEventListener(&#39;hashchange&#39;, bloombox.telemetry.urlDidChange_);&quot;,&quot;  bloombox.telemetry.checkURL_();  // begin the tick-based checker&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Begin handling telemetry data, starting with initial events to be dispatched&quot;,&quot; * and an initial server ping.&quot;,&quot; *&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.telemetry.boot = function() {&quot;,&quot;  if (bloombox.telemetry.didOptOut()) {&quot;,&quot;    // user opted out of telemetry&quot;,&quot;    bloombox.logging.warn(&quot;,&quot;      &#39;User opted-out of telemetry, skipping initial ping.&#39;);&quot;,&quot;  } else {&quot;,&quot;    // user has not yet opted out&quot;,&quot;    bloombox.logging.log(&#39;Sending initial telemetry ping...&#39;);&quot;,&quot;    bloombox.telemetry.ping(function(latency) {&quot;,&quot;      // as soon as the ping comes through, send the initial events&quot;,&quot;      bloombox.logging.log(&#39;Telemetry service is online. Ping latency: &#39; +&quot;,&quot;                           &#39;&#39; + latency + &#39;ms.&#39;);&quot;,&quot;      bloombox.telemetry.sendInitialEvents();&quot;,&quot;      bloombox.telemetry.setupPageTracking();&quot;,&quot;    });&quot;,&quot;  }&quot;,&quot;};&quot;]]]"></main><footer><div><a href="https://github.com/jleyba/js-dossier">Generated by dossier</a></div></footer></div><script src="../../../dossier.js" defer></script>