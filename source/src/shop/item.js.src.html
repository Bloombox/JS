<!DOCTYPE html><html lang="en" class="loading"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"><title>item.js</title><link href="../../../dossier.css" rel="stylesheet" type="text/css"><script src="../../../types.js" defer></script><header><button class="dossier-menu"><i class="material-icons">menu</i></button><form><input type="search" placeholder="Search" tabindex="1"><i class="material-icons">search</i></form></header><nav class="dossier-nav"></nav><div class="content"><main data-page-data="[null,null,null,[&quot;item.js&quot;,&quot;src/shop/item.js&quot;,[null,&quot;/*&quot;,&quot; * Copyright 2018, Bloombox, LLC. All rights reserved.&quot;,&quot; *&quot;,&quot; * Source and object computer code contained herein is the private intellectual&quot;,&quot; * property of Bloombox, a California Limited Liability Corporation. Use of this&quot;,&quot; * code in source form requires permission in writing before use or the&quot;,&quot; * assembly, distribution, or publishing of derivative works, for commercial&quot;,&quot; * purposes or any other purpose, from a duly authorized officer of Momentum&quot;,&quot; * Ideas Co.&quot;,&quot; *&quot;,&quot; * Unless required by applicable law or agreed to in writing, software&quot;,&quot; * distributed under the License is distributed on an \&quot;AS IS\&quot; BASIS,&quot;,&quot; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&quot;,&quot; * See the License for the specific language governing permissions and&quot;,&quot; * limitations under the License.&quot;,&quot; */&quot;,null,&quot;/**&quot;,&quot; * Bloombox Shop: Items&quot;,&quot; *&quot;,&quot; * @fileoverview Provides expression of shop inventory objects.&quot;,&quot; */&quot;,null,&quot;/*global goog */&quot;,&quot;goog.provide(&#39;bloombox.shop.Item&#39;);&quot;,null,&quot;goog.require(&#39;bloombox.product.Key&#39;);&quot;,&quot;goog.require(&#39;bloombox.product.Kind&#39;);&quot;,&quot;goog.require(&#39;bloombox.product.Weight&#39;);&quot;,&quot;goog.require(&#39;bloombox.util.Exportable&#39;);&quot;,null,&quot;goog.require(&#39;proto.opencannabis.commerce.Item&#39;);&quot;,&quot;goog.require(&#39;proto.opencannabis.commerce.VariantSpec&#39;);&quot;,&quot;goog.require(&#39;proto.opencannabis.temporal.Instant&#39;);&quot;,null,null,&quot;// -- Item -- //&quot;,&quot;/**&quot;,&quot; * Specifies an item that is being ordered as part of an Order.&quot;,&quot; *&quot;,&quot; * @param {bloombox.product.Key} key Key for the item.&quot;,&quot; * @param {number} count Count of this item to add to the order.&quot;,&quot; * @implements {bloombox.util.Exportable&lt;proto.opencannabis.commerce.Item&gt;}&quot;,&quot; * @constructor&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.Item = function Item(key,&quot;,&quot;                                   count) {&quot;,&quot;  /**&quot;,&quot;   * Key for this product item.&quot;,&quot;   *&quot;,&quot;   * @type {bloombox.product.Key}&quot;,&quot;   */&quot;,&quot;  this.key = key;&quot;,null,&quot;  /**&quot;,&quot;   * Count of this item to be ordered.&quot;,&quot;   *&quot;,&quot;   * @type {number}&quot;,&quot;   */&quot;,&quot;  this.count = count;&quot;,null,&quot;  /**&quot;,&quot;   * Variant specifications for this item.&quot;,&quot;   *&quot;,&quot;   * @type {Array&lt;!proto.opencannabis.commerce.VariantSpec&gt;}&quot;,&quot;   */&quot;,&quot;  this.variants = [];&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Retrieve the product key associated with this order item.&quot;,&quot; *&quot;,&quot; * @return {bloombox.product.Key} Item key.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.Item.prototype.getKey = function() {&quot;,&quot;  return this.key;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Return the count desired of this item.&quot;,&quot; *&quot;,&quot; * @return {number} Count desired.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.Item.prototype.getCount = function() {&quot;,&quot;  return this.count;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Get the weight variant for this item, if any.&quot;,&quot; *&quot;,&quot; * @return {bloombox.product.Weight} Weight variant for this product, if any, or&quot;,&quot; *         `Weight.NO_WEIGHT` if none is specified.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.Item.prototype.getWeightVariant = function() {&quot;,&quot;  // look for a weight variant&quot;,&quot;  for (let variantI = 0; variantI &lt; this.variants.length; variantI++) {&quot;,&quot;    let variantSpec = this.variants[variantI];&quot;,&quot;    if (variantSpec.hasWeight()) {&quot;,&quot;      return /** @type {bloombox.product.Weight} */ (&quot;,&quot;        variantSpec.getWeight());&quot;,&quot;    }&quot;,&quot;  }&quot;,&quot;  return bloombox.product.Weight.NO_WEIGHT;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Retrieve the size variant specified for this item, if any.&quot;,&quot; *&quot;,&quot; * @return {?string} Variant size string, if any, or `null`.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.Item.prototype.getSizeVariant = function() {&quot;,&quot;  // look for a weight variant&quot;,&quot;  for (let variantI = 0; variantI &lt; this.variants.length; variantI++) {&quot;,&quot;    let variantSpec = this.variants[variantI];&quot;,&quot;    if (variantSpec.hasSize()) {&quot;,&quot;      return variantSpec.getSize();&quot;,&quot;    }&quot;,&quot;  }&quot;,&quot;  return null;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Retrieve the cp;pr variant specified for this item, if any.&quot;,&quot; *&quot;,&quot; * @return {?string} Variant size string, if any, or `null`.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.Item.prototype.getColorVariant = function() {&quot;,&quot;  // look for a weight variant&quot;,&quot;  for (let variantI = 0; variantI &lt; this.variants.length; variantI++) {&quot;,&quot;    let variantSpec = this.variants[variantI];&quot;,&quot;    if (variantSpec.hasColor()) {&quot;,&quot;      return variantSpec.getColor();&quot;,&quot;    }&quot;,&quot;  }&quot;,&quot;  return null;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Inflate a product weight from a raw string or numerical reference.&quot;,&quot; *&quot;,&quot; * @param {string|number} rawWeight Raw weight value (i.e. &#39;EIGHTH&#39; or &#39;3&#39;).&quot;,&quot; * @return {bloombox.product.Weight} Weight value.&quot;,&quot; */&quot;,&quot;bloombox.shop.Item.inflateWeight = function(rawWeight) {&quot;,&quot;  if (typeof rawWeight === &#39;string&#39; || typeof rawWeight === &#39;number&#39;) {&quot;,&quot;    switch (rawWeight) {&quot;,&quot;      case &#39;NO_WEIGHT&#39;: return bloombox.product.Weight.NO_WEIGHT;&quot;,&quot;      case 0: return bloombox.product.Weight.NO_WEIGHT;&quot;,&quot;      case &#39;HALFGRAM&#39;: return bloombox.product.Weight.HALFGRAM;&quot;,&quot;      case 1: return bloombox.product.Weight.HALFGRAM;&quot;,&quot;      case &#39;GRAM&#39;: return bloombox.product.Weight.GRAM;&quot;,&quot;      case 2: return bloombox.product.Weight.GRAM;&quot;,&quot;      case &#39;EIGHTH&#39;: return bloombox.product.Weight.EIGHTH;&quot;,&quot;      case 3: return bloombox.product.Weight.EIGHTH;&quot;,&quot;      case &#39;QUARTER&#39;: return bloombox.product.Weight.QUARTER;&quot;,&quot;      case 4: return bloombox.product.Weight.QUARTER;&quot;,&quot;      case &#39;HALF&#39;: return bloombox.product.Weight.HALF;&quot;,&quot;      case 5: return bloombox.product.Weight.HALF;&quot;,&quot;      case &#39;OZ&#39;: return bloombox.product.Weight.OZ;&quot;,&quot;      case 6: return bloombox.product.Weight.OZ;&quot;,&quot;    }&quot;,&quot;  }&quot;,&quot;  return bloombox.product.Weight.NO_WEIGHT;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Decode a variant specification and attach it to the given item.&quot;,&quot; *&quot;,&quot; * @param {?Object} protob Raw protobuf object for the variant spec.&quot;,&quot; * @param {bloombox.shop.Item} item Item to add the variant to, if found.&quot;,&quot; */&quot;,&quot;bloombox.shop.Item.decodeVariant = function(protob,&quot;,&quot;                                            item) {&quot;,&quot;  // decode variant data&quot;,&quot;  if (typeof protob === &#39;object&#39; &amp;&amp; item) {&quot;,&quot;    // try decoding variant weight&quot;,&quot;    if (typeof protob[&#39;weight&#39;] === &#39;string&#39; ||&quot;,&quot;        typeof protob[&#39;weight&#39;] === &#39;number&#39;) {&quot;,&quot;      // decode weight&quot;,&quot;      let decodedWeight = bloombox.shop.Item.inflateWeight(protob[&#39;weight&#39;]);&quot;,&quot;      item.addWeightVariant(decodedWeight);&quot;,&quot;    } else if (typeof protob[&#39;size&#39;] === &#39;string&#39;) {&quot;,&quot;      item.addSizeVariant(protob[&#39;size&#39;]);&quot;,&quot;    } else if (typeof protob[&#39;color&#39;] === &#39;string&#39;) {&quot;,&quot;      item.addColorVariant(protob[&#39;color&#39;]);&quot;,&quot;    }&quot;,&quot;  }&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Decode an order item from a raw object response.&quot;,&quot; *&quot;,&quot; * @param {?Object} protob Raw object to decode an item from.&quot;,&quot; * @return {?bloombox.shop.Item} Decoded item, if one can be decoded, otherwise&quot;,&quot; *         `null` is returned.&quot;,&quot; */&quot;,&quot;bloombox.shop.Item.fromResponse = function(protob) {&quot;,&quot;  if (typeof protob === &#39;object&#39;) {&quot;,&quot;    // extract basic properties first&quot;,&quot;    let rawKey = /** @type {Object|null|undefined} */ (protob[&#39;key&#39;]);&quot;,&quot;    let rawCount = /** @type {number|null|undefined} */ (protob[&#39;count&#39;]);&quot;,&quot;    let rawVariants = /** @type {Array&lt;Object&gt;|null|undefined} */ (&quot;,&quot;      protob[&#39;variant&#39;]);&quot;,null,&quot;    if ((typeof rawKey === &#39;object&#39;) &amp;&amp; (typeof rawCount === &#39;number&#39;)) {&quot;,&quot;      // decode key first&quot;,&quot;      if (typeof rawKey[&#39;id&#39;] === &#39;string&#39;) {&quot;,&quot;        let rawKeyId = rawKey[&#39;id&#39;];&quot;,&quot;        let rawKeyType = /** @type {bloombox.product.Kind} */ (&quot;,&quot;          bloombox.product.Kind.FLOWERS);&quot;,null,&quot;        if (typeof rawKey[&#39;type&#39;] === &#39;object&#39;) {&quot;,&quot;          // we have a key type&quot;,&quot;          if (rawKey[&#39;type&#39;][&#39;kind&#39;]) {&quot;,&quot;            // we have a kind to resolve&quot;,&quot;            rawKeyType = bloombox.product.Key.inflateKind(&quot;,&quot;              rawKey[&#39;type&#39;][&#39;kind&#39;]);&quot;,&quot;          }&quot;,&quot;        }&quot;,null,&quot;        // create our key&quot;,&quot;        let key = new bloombox.product.Key(rawKeyId, rawKeyType);&quot;,null,&quot;        // we can proceed: we have the required info to make an item&quot;,&quot;        let item = new bloombox.shop.Item(key, rawCount || 1);&quot;,null,&quot;        // attempt to decode variants&quot;,&quot;        if (rawVariants &amp;&amp; Array.isArray(rawVariants)) {&quot;,&quot;          for (let variantI = 0; variantI &lt; rawVariants.length; variantI++) {&quot;,&quot;            bloombox.shop.Item.decodeVariant(&quot;,&quot;              rawVariants[variantI], item);&quot;,&quot;          }&quot;,&quot;        }&quot;,&quot;        return item;&quot;,&quot;      }&quot;,&quot;    }&quot;,&quot;  }&quot;,&quot;  return null;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Prepare a proto from an order item, suitable for use in an RPC.&quot;,&quot; *&quot;,&quot; * @return {proto.opencannabis.commerce.Item} Prepared proto.&quot;,&quot; * @public&quot;,&quot; */&quot;,&quot;bloombox.shop.Item.prototype.export = function() {&quot;,&quot;  let protob = new proto.opencannabis.commerce.Item();&quot;,null,&quot;  // set key&quot;,&quot;  let protoKey = this.key.export();&quot;,&quot;  protob.setKey(protoKey);&quot;,null,&quot;  // set count&quot;,&quot;  protob.setCount(this.count || 1);&quot;,null,&quot;  // prepare variant specs&quot;,&quot;  this.variants.map(function(item) {&quot;,&quot;    protob.addVariant(/** @type {!proto.opencannabis.commerce.VariantSpec} */ (&quot;,&quot;      item));&quot;,&quot;  });&quot;,&quot;  return protob;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Add a product variant.&quot;,&quot; *&quot;,&quot; * @param {proto.opencannabis.commerce.ProductVariant} type Type of variance to&quot;,&quot; *        specify.&quot;,&quot; * @param {*} content Content to specify as part of this variance.&quot;,&quot; * @return {bloombox.shop.Item} Subject item, for chain-ability.&quot;,&quot; * @package&quot;,&quot; */&quot;,&quot;bloombox.shop.Item.prototype._addVariant = function(type, content) {&quot;,&quot;  // make a variant spec&quot;,&quot;  let variantSpec = new proto.opencannabis.commerce.VariantSpec();&quot;,&quot;  variantSpec.setVariant(type);&quot;,null,&quot;  switch (type) {&quot;,&quot;    case proto.opencannabis.commerce.ProductVariant.SIZE:&quot;,&quot;      variantSpec.setSize(/** @type {string} */ (content));&quot;,&quot;      break;&quot;,&quot;    case proto.opencannabis.commerce.ProductVariant.WEIGHT:&quot;,&quot;      variantSpec.setWeight(&quot;,&quot;        /** @type {proto.opencannabis.commerce.ProductWeight} */ (content));&quot;,&quot;      break;&quot;,&quot;    case proto.opencannabis.commerce.ProductVariant.COLOR:&quot;,&quot;      variantSpec.setColor(/** @type {string} */ (content));&quot;,&quot;      break;&quot;,&quot;  }&quot;,null,&quot;  // add it to variants&quot;,&quot;  this.variants.push(variantSpec);&quot;,null,&quot;  // return self for chain-ability&quot;,&quot;  return this;&quot;,&quot;};&quot;,null,null,&quot;/**&quot;,&quot; * Add a weight variance specification to this item.&quot;,&quot; *&quot;,&quot; * @param {bloombox.product.Weight} weight Weight to specify.&quot;,&quot; * @return {bloombox.shop.Item} Subject item, for chain-ability.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.Item.prototype.addWeightVariant = function(weight) {&quot;,&quot;  return this._addVariant(proto.opencannabis.commerce.ProductVariant.WEIGHT,&quot;,&quot;    weight);&quot;,&quot;};&quot;,null,null,&quot;// noinspection JSUnusedGlobalSymbols&quot;,&quot;/**&quot;,&quot; * Add a size variance specification to this item.&quot;,&quot; *&quot;,&quot; * @param {string} size Size to specify.&quot;,&quot; * @return {bloombox.shop.Item} Subject item, for chain-ability.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.Item.prototype.addSizeVariant = function(size) {&quot;,&quot;  return this._addVariant(proto.opencannabis.commerce.ProductVariant.SIZE,&quot;,&quot;    size);&quot;,&quot;};&quot;,null,null,&quot;// noinspection JSUnusedGlobalSymbols&quot;,&quot;/**&quot;,&quot; * Add a color variance specification to this item.&quot;,&quot; *&quot;,&quot; * @param {string} color Color to specify.&quot;,&quot; * @return {bloombox.shop.Item} Subject item, for chain-ability.&quot;,&quot; * @export&quot;,&quot; */&quot;,&quot;bloombox.shop.Item.prototype.addColorVariant = function(color) {&quot;,&quot;  return this._addVariant(proto.opencannabis.commerce.ProductVariant.COLOR,&quot;,&quot;    color);&quot;,&quot;};&quot;]]]"></main><footer><div><a href="https://github.com/jleyba/js-dossier">Generated by dossier</a></div></footer></div><script src="../../../dossier.js" defer></script>